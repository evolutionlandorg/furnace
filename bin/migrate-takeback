#!/usr/bin/env bash

set -e

if [ "$FNC_VERBOSE" ]; then set -x; fi

. $(PWD)/bin/init


# ring=$(seth --to-bytes32 $(seth --to-hex $(seth --from-ascii "CONTRACT_RING_ERC20_TOKEN")))
# seth call $ISETTINGSREGISTRY "addressOf(bytes32)(address)" $ring 
path=$FNC_CONFIG
address=$(dapp create src/ItemTakeBack.sol:ItemTakeBack $ISETTINGSREGISTRY $SUPERVISOR $(seth --to-uint256 $CHAINID))
export ITEMTAKEBACK=$address
cat $path | jq '.ITEMTAKEBACK = $address' --arg address $ITEMTAKEBACK | sponge $path

authAddress=$(dapp create src/ItemBaseAuthority.sol:ItemBaseAuthority [$ITEMTAKEBACK])
export ITEMBASEAUTHORITY=$authAddress
seth call $ITEMBASEAUTHORITY "whiteList(address)" $ITEMTAKEBACK   
seth send -F $AUTH $ITEMBASE_PROXY "setAuthority(address)" $ITEMBASEAUTHORITY 
cat $path | jq '.ITEMBASEAUTHORITY = $address' --arg address $ITEMBASEAUTHORITY | sponge $path
