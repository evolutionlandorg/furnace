#!/usr/bin/env bash

set -e

. $(PWD)/bin/init

startTime=$(seth call $LANDRESOURCE_PROXY "resourceReleaseStartTime()(uint256)")
tokenId=$1

currentTime=$(date '+%s')
num=$(((currentTime - startTime) / 86400))

attr=$(seth call $LANDBASE_PROXY "getResourceRateAttr(uint256)" $tokenId)
echo $attr
gold_rate=$(seth --to-dec ${attr:62:4})
gold_crate=$(bc <<< "$gold_rate - $gold_rate * 0.0001 * $num")
echo "gold_rate"   "$gold_rate"   "$gold_crate"
wood_rate=$(seth --to-dec ${attr:58:4})
wood_crate=$(bc <<< "$wood_rate - $wood_rate * 0.0001 * $num")
echo "wood_rate"   "$wood_rate"   "$wood_crate"
water_rate=$(seth --to-dec ${attr:54:4})
water_crate=$(bc <<< "$water_rate - $water_rate * 0.0001 * $num")
echo "water_rate" "$water_rate"   "$water_crate"
fire_rate=$(seth --to-dec ${attr:50:4})
fire_crate=$(bc <<< "$fire_rate - $fire_rate * 0.0001 * $num")
echo "fire_rate"   "$fire_rate"   "$fire_crate"
soil_rate=$(seth --to-dec ${attr:46:4})
soil_crate=$(bc <<< "$soil_rate - $soil_rate * 0.0001 * $num")
echo "soil_rate"   "$soil_rate"   "$soil_crate"

currentTime=$(seth --to-uint256 $currentTime)
seth call $LANDRESOURCE_PROXY "getReleaseSpeed(uint256,address,uint256)(uint256)" $tokenId $TOKEN_GOLD $currentTime
seth call $LANDRESOURCE_PROXY "getReleaseSpeed(uint256,address,uint256)(uint256)" $tokenId $TOKEN_WOOD $currentTime
seth call $LANDRESOURCE_PROXY "getReleaseSpeed(uint256,address,uint256)(uint256)" $tokenId $TOKEN_WATER $currentTime
seth call $LANDRESOURCE_PROXY "getReleaseSpeed(uint256,address,uint256)(uint256)" $tokenId $TOKEN_FIRE $currentTime
seth call $LANDRESOURCE_PROXY "getReleaseSpeed(uint256,address,uint256)(uint256)" $tokenId $TOKEN_SOIL $currentTime

# seth call $LANDRESOURCE_PROXY "availableResources(uint256,address[5])(uint256,uint256,uint256,uint256,uint256)" $tokenId [$TOKEN_GOLD,$TOKEN_WOOD,$TOKEN_WATER,$TOKEN_FIRE,$TOKEN_SOIL]
echo "-----------------------------"
tokens=($TOKEN_GOLD $TOKEN_WOOD $TOKEN_WATER $TOKEN_FIRE $TOKEN_SOIL)
for token in "${tokens[@]}"; do
	landstrength=$(seth call $LANDRESOURCE_PROXY "getLandMiningStrength(uint256,address)(uint256)" $tokenId $token)
	barstrength=$(seth call $LANDRESOURCE_PROXY "getBarMiningStrength(uint256,address)(uint256)" $tokenId $token)
	echo "landstrength:"   "$landstrength"       barstrength:  "$barstrength"
done
